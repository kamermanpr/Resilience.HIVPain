---
title: 'Plot of time spent at 0, 1-24, 25-49, 50-74 and >75% of maximum activity'
author: 'Peter Kamerman'
date: '`r format(Sys.time(), "%B %d, %Y")`'
output: 
    md_document:
        variant: markdown_github
---

## Description
This script plots a box-and-whisker plot of the time spent by HIV-positive individuals with chronic pain and without chronic pain at 0, 1-24, 25-49, 50-74 and >75% of their maximum activity over a 7-day period. 

## Load required packages and set chunk options
```{r LoadPackages, include = FALSE}
# Load packages
library(knitr)
library(readr)
library(dplyr)
library(ggplot2)
library(scales)
library(grid)

# knitr chunk options
opts_chunk$set(echo = FALSE,
               warning = FALSE,
               message = FALSE,
               fig.path = './figures/',
               dev = c('png', 'pdf'),
               tidy = FALSE, 
               tidy.opts = list(width.cutoff = 65))
```

# Import data 
These data were generated by the Rmd script, *activity.analysis.Rmd*.
```{r DataImport, echo = TRUE}
q0 <- read_csv('./data/time.active.zero.csv')
q1 <- read_csv('./data/time.active.1q.csv')
q2 <- read_csv('./data/time.active.2q.csv')
q3 <- read_csv('./data/time.active.3q.csv')
q4 <- read_csv('./data/time.active.4q.csv')
```

# Process data for plotting
```{r DataProcessing, echo = TRUE}
# Create a grouping variable
group <- data.frame(quartile = c(rep(c('q0', 'q1', 'q2'), each = 68), 
                                 rep('q3', 66), # q3 only has 66 rows
                                 rep('q4', 68))) %>%
    tbl_df() # convert to tbl_df object

# Create a single dataframe with the imported data and the grouping variable
plot.data <- q0 %>%
    bind_rows(q1,q2,q3,q4) %>% # bind imported data q0 through q4 
    bind_cols(group) %>% # bind grouping variable
    select(quartile, pain, `minutes per day`) # select the columns to retain

# Quick check
glimpse(plot.data)
```

## Create the plot
```{r Plot}
# Create a hex colour palette (colourblind friendly)
cb1 <- c("#0072B2", "#D55E00") # line colours
cb2 <- c('#6fafd3', '#e7a46f') # lighter shade for fill

# Plot the data
plot_1 <- ggplot(data = plot.data, 
               aes(x = quartile, 
                   y = `minutes per day`, 
                   fill = pain, 
                   colour = pain)) + 
    geom_boxplot(position = position_dodge(0.85)) + 
    scale_x_discrete(labels = c("0", "1-24", "25-49", "50-74", "75-100")) +
    coord_cartesian(ylim = c(-20, 1400), 
                    xlim = c(0.5,5.5)) +
    scale_y_continuous(breaks = c(0, 200, 400, 600,800,1000,1200, 1400)) +
    labs(y = "Time (minutes)\n", 
         x = "\nPercentage of maximum activity (%)") +
    scale_colour_manual(values = cb1, 
                        labels = c("No pain", "Pain")) +
    scale_fill_manual(values = cb2, 
                      labels = c("No pain", "Pain")) +
    theme(axis.text = element_text(size = 18, colour = 'black'),
          axis.title = element_text(size = 18, colour='black'),
          axis.line = element_line(colour = 'black'),
          panel.background=element_blank(),
          panel.grid = element_blank(),
          legend.title = element_blank(),
          legend.key = element_blank(),
          legend.text = element_text(size = 18),
          legend.position = c(0.9, 0.9))
plot_1
```

## Session information
```{r SessionInfo}
sessionInfo()
```
