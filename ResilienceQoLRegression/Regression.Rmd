---
title: "Correlation between resilience and quality of life"
author: Peter Kamerman
date: '`r format(Sys.time(), "%d %B %Y")`'
output: 
  html_document:
    theme: flatly # {default,cerulean,flatly,readable,spacelab,united,cosmo}
    highlight: haddock # {default,tango,pygments,kate,monochrome,espresso,zenburn,haddock,textmate}
    toc: true
    toc_depth: 4
    number_sections: false
    self_contained: true
    keep_md: true
bibliography: references.bib
csl: references.csl
---
```r setwd('/Users/PeterKamerman/GoogleDrive/GitHub/HIVResilience/ResilienceQoLRegression')`

# Overview

# Data analysis
## Miscellaneous
```{r miscellaneous.1, echo=F, warning=F, message=F}
# Load libraries
library(pander)
library(knitr)
library(knitcitations)
library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggthemes)
library(grid) # for ggplot2
library(scales)
library(coin)
# Create library citation list
cleanbib()
options("citation_format" = "pandoc")
```

### R version used
- R version 3.1.2 (2014-10-31) -- "Pumpkin Helmet" `r citep(citation())`

### Packages used
- library(*pander*) `r citep(citation("pander"))`
- library(*knitr*) `r citep(citation("knitr"))`
- library(*knitcitations*) `r citep(citation("knitcitations"))`
- library(*readxl*) `r citep(citation("readxl"))`
- library(*dplyr*) `r citep(citation("dplyr"))`  
- library(*tidyr*) `r citep(citation("tidyr"))`
- library(*ggplot2*) `r citep(citation("ggplot2"))`
- library(*ggthemes*) `r citep(citation("ggthemes"))`
- library(*grid*) `r citep(citation("grid"))`
- library(*scales*) `r citep(citation("scales"))`
- library(*coin*) `r citep(citation("coin"))`

```{r miscellaneous.2, echo=F, warning=F, message=F}
write.bibtex(file="references.bib")
```

## Import data
```{r import, echo=T, warning=T, message=T, tidy=T, tidy.opts=list(width.cutoff=75)}
# Read csv
data<-read_excel("data.xlsx", sheet=1, col_names=T)
```

## Inspect and clean data
```{r clean, echo=T, warning=F, message=F, result='asis', tidy=T, tidy.opts=list(width.cutoff=75)}
# Inspect the data
str(data)
# Convert data classes as nessesary
data$PainState<-factor(data$PainState, levels=c("Pain","No pain"))
# Inspect the data
str(data)
pander(summary(data), justify="left", style='rmarkdown')
```

## Plot
```{r plot, echo=T, warning=F, message=F, tidy=T, tidy.opts=list(width.cutoff=75), fig.align='center', fig.height=7}
# All data
gg.all<-ggplot(data=data, aes(x=RSS, y=eq5d, fill=PainState)) +
    geom_jitter(shape=21, size=3, colour='black') +
    geom_smooth() +
    labs(x='Resilience scale score', y='EQ-5D VAS score', title='Relationship between resilience and quality of life\n(lines show loess smoother)') +
    theme_economist() +
    theme(axis.text=element_text(size=14),
          axis.title.y=element_text(size=14, vjust=1),
          axis.title.x=element_text(size=14, vjust=0.3),
          legend.text=element_text(size=14),
          legend.title=element_blank())
gg.all
```

## Spearman's correlation
### All data
```{r spearman.all, echo=T, warning=F, message=F, tidy=T, tidy.opts=list(width.cutoff=75)}
corr.all<-spearman_test(eq5d~RSS, data=data)
corr.all
```

### Stratified by pain state
```{r spearman.pain, echo=T, warning=F, message=F, tidy=T, tidy.opts=list(width.cutoff=75)}
corr.pain<-spearman_test(eq5d~RSS|PainState, data=data)
corr.pain
```

## References